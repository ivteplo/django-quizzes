{# Copyright (c) 2022 Ivan Teplov #}
{% extends 'layouts/form.html' %}
{% load reverse_url %}
{% load static %}

{% block title %}
    Add question to a quiz | Quizzes
{% endblock %}

{% block body %}
    {% include 'components/back-button.html' %}
    {% with form_method="POST" form_action="add-quiz-question"|reverse_url:quiz.url %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block form_body %}
    <h1 class="form-title">Add a Question</h1>
    <p>Adding a question to this quiz: {{ quiz.name }}</p>

    <div class="form-input-wrapper">
        <label for="question">Question</label>
        <input type="text" id="question" name="question" placeholder="Question to ask" required
            {% if form.question %} value="{{ form.question }}" {% endif %}>
    </div>
    <div class="form-input-wrapper">
        <label>Question type</label>
        {% for question_type in question_types %}
            {% with id=question_type.id|stringformat:"d-question-type" %}
                <div class="row">
                    <input type="radio" id="{{ id }}" name="question-type" value="{{ question_type.id }}" required
                        {% if form.question_type == question_type.id %} checked {% endif %}>
                    &nbsp;
                    <label for="{{ id }}">{{ question_type.text }}</label>
                </div>
            {% endwith %}
        {% endfor %}
    </div>
    <div class="form-input-wrapper column">
        <label for="answer">Answers</label>
        {% for answer in form.answers %}
            <div class="row">
                <input type="hidden" name="answers[{{ forloop.counter0 }}][is_right]" value="off">
                <input type="checkbox" name="answers[{{ forloop.counter0 }}][is_right]"
                    {% if answer.is_right == 'on' %} checked {% endif %}>
                <input type="text" name="answers[{{ forloop.counter0 }}][text]" placeholder="Answer"
                    {% if answer.text %} value="{{ answer.text }}" {% endif %}>
            </div>
        {% endfor %}
        <button id="add-more-answers" type="button" data-next-id="{{ form.answers|length }}">Add answers</button>
    </div>
    <button type="submit">Add question</button>

    {# TODO: find a way to fix unchecked checkboxes not submitting a value #}
    {# TODO: add support for deleting answers #}
    <script>
        $(function() {
            const button = $('#add-more-answers')
            let nextId = button.data('next-id')
            button.click(function() {
                $('<div class="row"></div>').append(
                    `<input type="hidden" name="answers[${nextId}][is_right]" value='off'>`,
                    `<input type="checkbox" name="answers[${nextId}][is_right]">`,
                    `<input type="text" name="answers[${nextId}][text]" placeholder="Answer">`
                ).insertBefore($(this))

                nextId += 1
            })
        })
    </script>
{% endblock %}
